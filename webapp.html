<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —á–∞—Ç</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    body { background:#0e0e0e; color:#fff; margin:0 }
    #chat { padding:12px }
    .msg { margin:8px; padding:10px; border-radius:10px; max-width:80% }
    .me { background:#2b5278; margin-left:auto; text-align:right }
    .other { background:#1e1e1e }
    .name { font-size:12px; opacity:.6 }
    .time { font-size:11px; opacity:.4 }
    .media { color:#5cc8ff; font-weight:bold }
  </style>
</head>

<body>
<h2>üìÇ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —á–∞—Ç</h2>
<div id="chat">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

const params = new URLSearchParams(window.location.search);
const chatId = params.get("chat_id");
const userId = tg.initDataUnsafe.user.id;

fetch(`/api/chat?owner_id=${userId}&chat_id=${chatId}`)
  .then(r => r.json())
  .then(d => {
    const el = document.getElementById("chat");
    el.innerHTML = "";

    d.messages.forEach(m => {
      const isMine = m.is_owner === true;

      let html = `
        <div class="msg ${isMine ? "me" : "other"}">
          <div class="name">${m.name}</div>
      `;

      else {
        if (!m.file_id) {
          html += `<div class="media">‚ùå —Ñ–∞–π–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</div>`;
        } else {
          html += `
            <a class="media"
               href="/api/file?file_id=${m.file_id}"
               target="_blank">
               üìé ${m.type}
            </a>
          `;
        }
      }

      html += `<div class="time">${new Date(m.time).toLocaleString()}</div></div>`;
      el.insertAdjacentHTML("beforeend", html);
    });
  });
</script>
</body>
</html>
